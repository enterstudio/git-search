#!/bin/sh

help()
{
  echo 'Usage:'
  echo '  git-search --index'
  echo '  git-search <search terms>'
}

REPO_BASE=`git rev-parse --show-toplevel`
if [ 0 -ne $? ]; then
  echo $REPO_BASE
  exit 1
fi

INDEX="$REPO_BASE/.gitsearch/index"

SOURCE=$0
while [ -h "$SOURCE" ] ; do SOURCE="$(readlink "$SOURCE")"; done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

GIT_SEARCH_BASE=`dirname $DIR`
export CLASSPATH="$GIT_SEARCH_BASE/lucene-core-3.5.0.jar:$GIT_SEARCH_BASE/src"

COMMAND=$1

if [ -z $COMMAND ]; then
    help
elif [ $COMMAND == '--index' ]; then
  java com.github.tenorviol.gitsearch.IndexFiles -index $INDEX -docs $REPO_BASE
else
  java com.github.tenorviol.gitsearch.SearchFiles -index $INDEX -query $COMMAND
fi
